<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RikDraft</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }

body {
  background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
  color: white;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  padding: 2rem;
}

h1, h2 { margin: .5rem 0; }
h1 {
  font-size: 2.4rem;
  text-align: center;
  background: linear-gradient(90deg, #00c6ff, #0072ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.container {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(8px);
  border-radius: 1.2rem;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  width: 100%;
  max-width: 700px;
  padding: 1.5rem 2rem;
  display: flex;
  flex-direction: column;
  transition: all 0.4s ease;
  overflow: hidden;
}

.scrollable {
  flex: 1;
  overflow-y: auto;
  padding-right: .3rem;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.3) transparent;
}
.scrollable::-webkit-scrollbar { width: 6px; }
.scrollable::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }

.team-list { display: flex; flex-direction: column; gap: .5rem; }
.team-input { display: flex; align-items: center; gap: .5rem; }
input {
  flex: 1; padding: .6rem .8rem; border: none; border-radius: .5rem;
  background: rgba(255,255,255,0.15); color: white; font-size: .95rem;
  transition: background .3s;
}
input:focus { background: rgba(255,255,255,0.25); }

.delete-btn {
  background: rgba(255,255,255,0.15);
  border: none;
  border-radius: 50%;
  width: 30px; height: 30px;
  color: #ff7b7b;
  font-weight: bold;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .25s;
}
.delete-btn:hover { background: rgba(255,0,0,0.4); color: white; transform: scale(1.1); }

.btn-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: .5rem;
  margin-top: .5rem;
}

button, select {
  padding: .8rem;
  border: none;
  border-radius: .6rem;
  font-weight: 600;
  background: linear-gradient(90deg, #00c6ff, #0072ff);
  color: white;
  cursor: pointer;
  transition: all .25s;
}
button:hover { transform: scale(1.03); opacity: .9; }
select { background: rgba(255,255,255,0.15); color: white; }

#resetBtn, .back-btn { background: linear-gradient(90deg,#ff4e50,#f9d423); }

.results, .map-results {
  flex: 1;
  overflow-y: auto;
  padding: .5rem;
}

.team-item, .map-item {
  background: rgba(255,255,255,0.1);
  border-radius: .8rem;
  padding: .7rem 1rem;
  margin-bottom: .5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  animation: fadeIn .4s ease;
}

.map-item img { width: 220px; border-radius: 0.8rem; margin-bottom: .3rem; }

.pools {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  gap: 1rem;
}
.pool {
  flex: 1;
  min-width: 220px;
  background: rgba(255,255,255,0.08);
  border-radius: 1rem;
  padding: .8rem;
}
.pool h3 { text-align: center; color: #00c6ff; }

.footer {
  font-size: .8rem;
  text-align: center;
  margin-top: .5rem;
  opacity: .7;
}

.hidden { display: none; }

.view {
  opacity: 1;
  transform: translateY(0);
  transition: opacity .4s, transform .4s;
}
.view.hidden { opacity: 0; transform: translateY(20px); pointer-events: none; }

.hidden-file { display: none; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<div class="container">
  <h1>🎮 RikDraft</h1>

  <!-- Sélection du type de tirage -->
  <div id="selectionView" class="view">
    <h2>Choisis le type de tirage</h2>
    <div class="btn-grid">
      <button id="teamDrawBtn">🎲 Tirage d'équipe</button>
      <button id="mapDrawBtn">🗺️ Tirage de map</button>
    </div>
  </div>

  <!-- Setup équipe -->
  <div id="setupView" class="view hidden">
    <div class="scrollable">
      <div class="team-list" id="teamList"></div>
    </div>

    <div class="btn-grid">
      <button id="addTeam">➕ Ajouter</button>
      <button id="resetBtn">♻️ Réinitialiser</button>
      <button id="saveBtn">💾 Sauver</button>
      <button id="loadBtn">📂 Charger</button>
    </div>

    <!-- Nouveau bouton retour -->
    <button class="back-btn" id="setupBackBtn">🔙 Retour au menu</button>

    <input type="file" id="fileInput" class="hidden-file" accept=".csv" />
    <select id="modeSelect">
      <option value="liste">📋 Liste numérotée</option>
      <option value="poules">🏆 Deux poules (A / B)</option>
    </select>
    <button id="drawBtn">🎲 Tirer au sort</button>
  </div>

  <!-- Résultats équipe -->
  <div id="resultView" class="view hidden">
    <h2 style="text-align:center;">Résultats du tirage</h2>
    <div class="results" id="resultsContainer"></div>
    <button class="back-btn" id="backBtn">🔙 Retour</button>
  </div>

  <!-- Tirage map -->
  <div id="mapView" class="view hidden">
    <h2 style="text-align:center;">Tirage de map</h2>
    
    <!-- Étape 1 : miniatures -->
    <div class="map-results" id="mapThumbnails"></div>
    
    <!-- Étape 2 : map sélectionnée -->
    <div class="map-results hidden" id="selectedMap"></div>
    
    <div class="btn-grid">
      <button id="mapDrawBtnStage2">🎲 Tirer au sort</button>
      <button class="back-btn" id="mapBackBtn">🔙 Retour</button>
    </div>
  </div>

  <div class="footer">Made by Mascret Clement</div>
</div>

<script>
/* --- Variables --- */
const selectionView = document.getElementById('selectionView');
const teamDrawBtn = document.getElementById('teamDrawBtn');
const mapDrawBtn = document.getElementById('mapDrawBtn');
const setupView = document.getElementById('setupView');
const mapView = document.getElementById('mapView');
const resultsContainer = document.getElementById('resultsContainer');
const backBtn = document.getElementById('backBtn');
const mapBackBtn = document.getElementById('mapBackBtn');
const setupBackBtn = document.getElementById('setupBackBtn');

const teamList=document.getElementById('teamList');
const addTeamBtn=document.getElementById('addTeam');
const resetBtn=document.getElementById('resetBtn');
const saveBtn=document.getElementById('saveBtn');
const loadBtn=document.getElementById('loadBtn');
const fileInput=document.getElementById('fileInput');
const drawBtn=document.getElementById('drawBtn');
const modeSelect=document.getElementById('modeSelect');

const mapThumbnails = document.getElementById('mapThumbnails');
const selectedMap = document.getElementById('selectedMap');
const mapDrawBtnStage2 = document.getElementById('mapDrawBtnStage2');

let teamCount=0;
const maxTeams=10;
const defaultTeams=[
  "FriendJoystickFire","FC Genost","Dark Falco","Saint-Martin au volant","CSV Power",
  "Gypsy Dragon","Eternal Dragons","ScarletSnake","QuentinWeb","ACCL"
];

/* Maps */
const maps = [
  { name: "Valée Yoshi ", img: "map1.png" },
  { name: "Route Arc-en-ciel", img: "map2.png" },
  { name: "Station Glagla", img: "map3.png" },
  { name: "Circuit Yoshi ", img: "map4.png" }
];

/* --- Fonctions équipe --- */
function refreshPlaceholders(){ document.querySelectorAll('.team-input input').forEach((i,index)=>i.placeholder=`Équipe ${index+1}`);}
function addTeamInput(value=""){ 
  if(teamCount>=maxTeams){ alert("Max 10 équipes !"); return; }
  teamCount++;
  const div=document.createElement('div');
  div.classList.add('team-input');
  div.innerHTML=`<input value="${value}" placeholder="Équipe ${teamCount}"><button class="delete-btn">×</button>`;
  div.querySelector('.delete-btn').onclick=()=>{ div.remove(); teamCount--; refreshPlaceholders(); };
  teamList.appendChild(div);
}
defaultTeams.forEach(addTeamInput);
function resetAll(){ teamList.innerHTML=""; teamCount=0; }
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }
function generateList(teams){ 
  resultsContainer.innerHTML="";
  shuffle(teams).forEach((t,i)=>{ 
    const item=document.createElement('div'); item.className="team-item"; 
    item.innerHTML=`<strong>${i+1}.</strong> ${t}`;
    resultsContainer.appendChild(item); 
  });
}
function generatePools(teams){ 
  const s=shuffle(teams); 
  const mid=Math.ceil(s.length/2); 
  const poolA=s.slice(0,mid), poolB=s.slice(mid);
  resultsContainer.innerHTML=`<div class="pools"><div class="pool" id="poolA"><h3>Poule A</h3></div><div class="pool" id="poolB"><h3>Poule B</h3></div></div>`;
  poolA.forEach(t=>{ const d=document.createElement('div'); d.className="team-item"; d.textContent=t; document.getElementById('poolA').appendChild(d); });
  poolB.forEach(t=>{ const d=document.createElement('div'); d.className="team-item"; d.textContent=t; document.getElementById('poolB').appendChild(d); });
}
function drawMatches(){
  const teams=[...document.querySelectorAll('#teamList input')].map(i=>i.value.trim()).filter(Boolean);
  if(teams.length<2){ alert("Ajoute au moins 2 équipes !"); return; }
  modeSelect.value==="liste"?generateList(teams):generatePools(teams);
  setupView.classList.add('hidden'); selectionView.classList.add('hidden'); mapView.classList.add('hidden'); 
  document.getElementById('resultView').classList.remove('hidden');
}
function goBack(){ document.getElementById('resultView').classList.add('hidden'); setupView.classList.remove('hidden'); selectionView.classList.add('hidden'); }

/* --- CSV --- */
function saveCSV(){
  const teams=[...document.querySelectorAll('#teamList input')].map(i=>i.value.trim()).filter(Boolean);
  if(!teams.length){ alert("Aucune équipe !"); return; }
  const blob=new Blob([teams.join("\n")],{type:"text/csv;charset=utf-8"});
  const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="teams.csv"; link.click();
}
function loadCSV(){ fileInput.click(); }
fileInput.onchange=e=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{ const lines=ev.target.result.split(/\r?\n/).filter(l=>l.trim()); resetAll(); lines.forEach(addTeamInput); };
  reader.readAsText(file);
};

/* --- Tirage map --- */
function showAllMaps() {
  mapThumbnails.innerHTML = "";
  selectedMap.classList.add('hidden');
  mapThumbnails.classList.remove('hidden');

  maps.forEach(m => {
    const div = document.createElement('div');
    div.className = "map-item";
    div.innerHTML = `<img src="${m.img}" alt="${m.name}"><strong>${m.name}</strong>`;
    mapThumbnails.appendChild(div);
  });
}

function drawSelectedMap() {
  const shuffled = shuffle(maps);
  const selected = shuffled[0];

  mapThumbnails.classList.add('hidden');
  selectedMap.classList.remove('hidden');
  selectedMap.innerHTML = `<div class="map-item"><img src="${selected.img}" alt="${selected.name}"><strong>${selected.name}</strong></div>`;
}

/* --- Navigation --- */
teamDrawBtn.onclick=()=>{ selectionView.classList.add('hidden'); setupView.classList.remove('hidden'); mapView.classList.add('hidden'); }
mapDrawBtn.onclick=()=>{ selectionView.classList.add('hidden'); setupView.classList.add('hidden'); mapView.classList.remove('hidden'); showAllMaps(); }
backBtn.onclick=goBack;
mapBackBtn.onclick=()=>{ mapView.classList.add('hidden'); selectionView.classList.remove('hidden'); setupView.classList.add('hidden'); }
setupBackBtn.onclick = () => {
  setupView.classList.add('hidden');
  selectionView.classList.remove('hidden');
};

/* --- Boutons setup équipe --- */
addTeamBtn.onclick=()=>addTeamInput();
resetBtn.onclick=resetAll;
drawBtn.onclick=drawMatches;
saveBtn.onclick=saveCSV;
loadBtn.onclick=loadCSV;

/* --- Bouton tirage map étape 2 --- */
mapDrawBtnStage2.onclick = drawSelectedMap;

</script>

</body>
</html>
