<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RikDraft</title>
  <link rel="icon" type="image/png" href="rik.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!--
    =====================================================
    STYLE PRINCIPAL (INLINE)
    - Le CSS est volontairement inclus inline pour faciliter le
      d√©ploiement sur une seule page (aucune d√©pendance externe).
    - Les commentaires ci-dessous expliquent la structure visuelle,
      les classes importantes et les choix d'accessibilit√© / layout.
    =====================================================
  -->
  <style>
  /*
    Reset / base
    - box-sizing : √©viter les surprises li√©es au padding/width
    - font-family : coh√©rence visuelle (Poppins import√© plus haut)
  */
  * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }

  /*
    BODY
    - Utilise un d√©grad√© sombre en arri√®re-plan pour un bon contraste
    - Flex column centr√© pour garder l'interface au centre de l'√©cran
    - padding + min-height pour assurer un rendu correct sur petits √©crans
  */
  body {
    background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
    color: white;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 2rem;
    position: relative;
  }

  /* Titres : taille et effet gradient pour un rendu moderne */
  h1, h2 { margin: .5rem 0; }
  h1 {
    font-size: 2.4rem;
    text-align: center;
    background: linear-gradient(90deg, #00c6ff, #0072ff);
  background-clip: text; /* standard property for broader compatibility */
  -webkit-background-clip: text; /* fallback for older WebKit browsers */
  -webkit-text-fill-color: transparent; /* keep text transparent so gradient shows */
  }

  /*
    CONTAINER PRINCIPAL
    - Fond semi-transparent + flou pour effet 'glassmorphism'
    - max-width pour limiter la largeur sur grand √©cran
  */
  .container {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
    border-radius: 1.2rem;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    width: 100%;
    max-width: 700px;
    padding: 1.5rem 2rem;
    display: flex;
    flex-direction: column;
    transition: all 0.4s ease;
    overflow: hidden;
  }

  /* Zone scrollable interne (liste d'√©quipes, r√©sultats) */
  .scrollable {
    flex: 1;
    overflow-y: auto;
    padding-right: .3rem;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.3) transparent;
  }
  .scrollable::-webkit-scrollbar { width: 6px; }
  .scrollable::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }

  /* √âl√©ments d'entr√©e des √©quipes */
  .team-list { display: flex; flex-direction: column; gap: .5rem; }
  .team-input { display: flex; align-items: center; gap: .5rem; }
  input {
    flex: 1; padding: .6rem .8rem; border: none; border-radius: .5rem;
    background: rgba(255,255,255,0.15); color: white; font-size: .95rem;
    transition: background .3s;
  }
  input:focus { background: rgba(255,255,255,0.25); }

  /* Bouton pour supprimer une √©quipe (rond, clair) */
  .delete-btn {
    background: rgba(255,255,255,0.15);
    border: none;
    border-radius: 50%;
    width: 30px; height: 30px;
    color: #ff7b7b;
    font-weight: bold;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all .25s;
  }
  .delete-btn:hover { background: rgba(255,0,0,0.4); color: white; transform: scale(1.1); }

  /* Grille de boutons (2 colonnes) utilis√©e dans plusieurs vues */
  .btn-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: .5rem;
    margin-top: .5rem;
  }

  /* Style par d√©faut des boutons / select */
  button, select {
    padding: .8rem;
    border: none;
    border-radius: .6rem;
    font-weight: 600;
    background: linear-gradient(90deg, #00c6ff, #0072ff);
    color: white;
    cursor: pointer;
    transition: all .25s;
  }
  button:hover { transform: scale(1.03); opacity: .9; }
  select { background: rgba(255,255,255,0.15); color: white; }

  /* Boutons de retour / reset : couleur diff√©rente pour signaler action critique */
  #resetBtn, .back-btn { background: linear-gradient(90deg,#ff4e50,#f9d423); }

  /* Conteneurs de r√©sultats (liste ou maps) */
  .results, .map-results {
    flex: 1;
    overflow-y: auto;
    padding: .5rem;
  }

  /* Item d'√©quipe / map : carte simple avec animation d'apparition */
  .team-item, .map-item {
    background: rgba(255,255,255,0.1);
    border-radius: .8rem;
    padding: .7rem 1rem;
    margin-bottom: .5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    animation: fadeIn .4s ease;
  }

  .map-item img { width: 220px; border-radius: 0.8rem; margin-bottom: .3rem; }

  /* Mise en page pour les poules (A/B) */
  .pools {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 1rem;
  }
  .pool {
    flex: 1;
    min-width: 220px;
    background: rgba(255,255,255,0.08);
    border-radius: 1rem;
    padding: .8rem;
  }
  .pool h3 { text-align: center; color: #00c6ff; }

  /* Footer : positionn√© sous le container principal */
  .footer {
    font-size: .8rem;
    text-align: center;
    opacity: .7;
    position: absolute;
    bottom: 10px;
    width: 100%;
  }

  /* Utilitaires pour masquer/afficher des vues */
  .hidden { display: none; }

  .view {
    opacity: 1;
    transform: translateY(0);
    transition: opacity .4s, transform .4s;
  }
  .view.hidden { opacity: 0; transform: translateY(20px); pointer-events: none; }

  .hidden-file { display: none; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  </style>
</head>
<body>

  <!--
    =====================================================
    STRUCTURE HTML
    - L'application est une SPA (single page app) sans framework.
    - Trois vues principales :
      1) selectionView : choisir Tirage d'√©quipe ou Tirage de map
      2) setupView     : configurer les √©quipes (ajout, CSV, mode)
      3) resultView    : afficher le r√©sultat du tirage
      4) mapView       : galerie et tirage de carte
    - Les vues sont simplement masqu√©es/affich√©es via la classe `.hidden`.
    =====================================================
  -->

  <div class="container">
    <h1>üéÆ RikDraft</h1>

    <!-- S√©lection du type de tirage -->
    <div id="selectionView" class="view">
      <h2>Choisis le type de tirage</h2>
      <div class="btn-grid">
        <button id="teamDrawBtn">üé≤ Tirage d'√©quipe</button>
        <button id="mapDrawBtn">üó∫Ô∏è Tirage de map</button>
      </div>
    </div>

    <!-- Setup √©quipe
         - Contient la liste dynamique d'inputs
         - Boutons : ajouter, r√©initialiser, sauver/charger CSV
         - Selector de mode : liste ou poules
    -->
    <div id="setupView" class="view hidden">
      <div class="scrollable">
        <div class="team-list" id="teamList"></div>
      </div>

      <div class="btn-grid">
        <button id="addTeam">‚ûï Ajouter</button>
        <button id="resetBtn">‚ôªÔ∏è R√©initialiser</button>
        <button id="saveBtn">üíæ Sauver</button>
        <button id="loadBtn">üìÇ Charger</button>
      </div>

      <button class="back-btn" id="setupBackBtn">üîô Retour au menu</button>

      <!-- input file cach√© pour chargement CSV (utilis√© par le bouton Charger) -->
      <input type="file" id="fileInput" class="hidden-file" accept=".csv" />
      <select id="modeSelect">
        <option value="liste">üìã Liste num√©rot√©e</option>
        <option value="poules">üèÜ Deux poules (A / B)</option>
      </select>
      <button id="drawBtn">üé≤ Tirer au sort</button>
    </div>

    <!-- R√©sultats √©quipe -->
    <div id="resultView" class="view hidden">
      <h2 style="text-align:center;">R√©sultats du tirage</h2>
      <div class="results" id="resultsContainer"></div>
      <button class="back-btn" id="backBtn">üîô Retour</button>
    </div>

    <!-- Tirage map : galerie puis affichage de la map s√©lectionn√©e -->
    <div id="mapView" class="view hidden">
      <h2 style="text-align:center;">Tirage de map</h2>
      <div class="map-results" id="mapThumbnails"></div>
      <div class="map-results hidden" id="selectedMap"></div>
      
      <div class="btn-grid">
        <button id="mapDrawBtnStage2">üé≤ Tirer au sort</button>
        <button class="back-btn" id="mapBackBtn">üîô Retour</button>
      </div>
    </div>
  </div>

  <!-- Footer d√©sormais sous la bo√Æte principale -->
  <div class="footer">Made by Mascret Clement</div>

  <!--
    =====================================================
    SCRIPT EMBEDDED
    - Toutes les fonctions JS sont incluses ici pour simplifier la
      distribution (page unique). Les commentaires ci-dessous
      documentent l'API interne (fonctions, entr√©es, sorties).
    - Contrat minimal :
      * Entr√©es : valeurs des champs d'input (√©quipes) et interactions UI
      * Sorties : DOM modifi√© (r√©sultats), fichier CSV g√©n√©r√© lors du save
      * Erreurs g√©r√©es : alert() pour retours utilisateur simples
    =====================================================
  -->
  <script>
  /* --- Variables DOM principales (cache des s√©lections) ---
     - Garder ces r√©f√©rences √©vite des recherches DOM r√©p√©t√©es.
  */
  const selectionView = document.getElementById('selectionView');
  const teamDrawBtn = document.getElementById('teamDrawBtn');
  const mapDrawBtn = document.getElementById('mapDrawBtn');
  const setupView = document.getElementById('setupView');
  const mapView = document.getElementById('mapView');
  const resultsContainer = document.getElementById('resultsContainer');
  const backBtn = document.getElementById('backBtn');
  const mapBackBtn = document.getElementById('mapBackBtn');
  const setupBackBtn = document.getElementById('setupBackBtn');

  const teamList=document.getElementById('teamList');
  const addTeamBtn=document.getElementById('addTeam');
  const resetBtn=document.getElementById('resetBtn');
  const saveBtn=document.getElementById('saveBtn');
  const loadBtn=document.getElementById('loadBtn');
  const fileInput=document.getElementById('fileInput');
  const drawBtn=document.getElementById('drawBtn');
  const modeSelect=document.getElementById('modeSelect');

  const mapThumbnails = document.getElementById('mapThumbnails');
  const selectedMap = document.getElementById('selectedMap');
  const mapDrawBtnStage2 = document.getElementById('mapDrawBtnStage2');

  /* --- Donn√©es / constantes --- */
  let teamCount=0;                    // compteur d'inputs affich√©s
  const maxTeams=10;                  // limite op√©rationnelle
  const defaultTeams=[                // √©quipes par d√©faut affich√©es au chargement
    "FriendJoystickFire","FC Genost","Dark Falco","Saint-Martin au volant","CSV Power",
    "Gypsy Dragon","Eternal Dragons","ScarletSnake","QuentinWeb","ACCL"
  ];

  /* Maps : tableau d'objets {name, img} (facile √† √©tendre) */
  const maps = [
    { name: "Val√©e Yoshi ", img: "map1.png" },
    { name: "Route Arc-en-ciel", img: "map2.png" },
    { name: "Station Glagla", img: "map3.png" },
    { name: "Circuit Yoshi ", img: "map4.png" }
  ];

  /* --- Fonctions √©quipe --- */
  /**
   * refreshPlaceholders()
   * - Met √† jour les placeholders pour refl√©ter l'ordre visible
   * - Aucun param√®tre, aucune valeur de retour
   */
  function refreshPlaceholders(){ document.querySelectorAll('.team-input input').forEach((i,index)=>i.placeholder=`√âquipe ${index+1}`);}

  /**
   * addTeamInput(value = "")
   * - Ajoute dynamiquement un champ d'input pour une √©quipe
   * - value : texte initial √† placer dans l'input (optionnel)
   * - Contraintes : n'ajoute pas au del√† de `maxTeams`
   */
  function addTeamInput(value=""){ 
    if(teamCount>=maxTeams){ alert("Max 10 √©quipes !"); return; }
    teamCount++;
    const div=document.createElement('div');
    div.classList.add('team-input');
    div.innerHTML=`<input value="${value}" placeholder="√âquipe ${teamCount}"><button class="delete-btn">√ó</button>`;

    // suppression locale : met √† jour l'√©tat et les placeholders
    div.querySelector('.delete-btn').onclick=()=>{ div.remove(); teamCount--; refreshPlaceholders(); };
    teamList.appendChild(div);
  }

  // Initialisation : pr√©remplit la liste avec des √©quipes par d√©faut
  defaultTeams.forEach(addTeamInput);

  /**
   * resetAll()
   * - Vide la liste d'√©quipes et remet le compteur √† z√©ro
   * - Utilis√© pour recharger via CSV ou pour recommencer
   */
  function resetAll(){ teamList.innerHTML=""; teamCount=0; }

  /**
   * shuffle(arr) -> array
   * - M√©lange un tableau (retourne une nouvelle r√©f√©rence m√©lang√©e)
   * - NOTE : utilisation de sort() avec Math.random() est acceptable ici
   *   car on ne cherche pas une distribution cryptographique.
   */
  function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

  /**
   * generateList(teams)
   * - Cr√©e une liste num√©rot√©e des √©quipes tir√©es au sort
   * - teams : tableau de strings (noms d'√©quipes)
   */
  function generateList(teams){ 
    resultsContainer.innerHTML="";
    shuffle(teams).forEach((t,i)=>{ 
      const item=document.createElement('div'); item.className="team-item"; 
      item.innerHTML=`<strong>${i+1}.</strong> ${t}`;
      resultsContainer.appendChild(item); 
    });
  }

  /**
   * generatePools(teams)
   * - R√©partit les √©quipes en deux poules A/B (taille √©quilibr√©e)
   * - Affiche chaque poule dans le container des r√©sultats
   */
  function generatePools(teams){ 
    const s=shuffle(teams); 
    const mid=Math.ceil(s.length/2); 
    const poolA=s.slice(0,mid), poolB=s.slice(mid);
    resultsContainer.innerHTML=`<div class="pools"><div class="pool" id="poolA"><h3>Poule A</h3></div><div class="pool" id="poolB"><h3>Poule B</h3></div></div>`;
    poolA.forEach(t=>{ const d=document.createElement('div'); d.className="team-item"; d.textContent=t; document.getElementById('poolA').appendChild(d); });
    poolB.forEach(t=>{ const d=document.createElement('div'); d.className="team-item"; d.textContent=t; document.getElementById('poolB').appendChild(d); });
  }

  /**
   * drawMatches()
   * - Prend les valeurs actuelles des inputs d'√©quipe
   * - Valide qu'il y a au moins 2 √©quipes
   * - Selon le mode (liste / poules) affiche le rendu correspondant
   * - Cache les vues de configuration et affiche les r√©sultats
   */
  function drawMatches(){
    const teams=[...document.querySelectorAll('#teamList input')].map(i=>i.value.trim()).filter(Boolean);
    if(teams.length<2){ alert("Ajoute au moins 2 √©quipes !"); return; }
    modeSelect.value==="liste"?generateList(teams):generatePools(teams);
    setupView.classList.add('hidden'); selectionView.classList.add('hidden'); mapView.classList.add('hidden'); 
    document.getElementById('resultView').classList.remove('hidden');
  }

  function goBack(){ document.getElementById('resultView').classList.add('hidden'); setupView.classList.remove('hidden'); selectionView.classList.add('hidden'); }

  /* --- CSV (import / export) --- */
  /**
   * saveCSV()
   * - Extrait les noms d'√©quipes, cr√©e un Blob CSV et force le t√©l√©chargement
   * - Utilis√© pour sauvegarder rapidement la configuration
   */
  function saveCSV(){
    const teams=[...document.querySelectorAll('#teamList input')].map(i=>i.value.trim()).filter(Boolean);
    if(!teams.length){ alert("Aucune √©quipe !"); return; }
    const blob=new Blob([teams.join("\n")],{type:"text/csv;charset=utf-8"});
    const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="teams.csv"; link.click();
  }

  function loadCSV(){ fileInput.click(); }
  fileInput.onchange=e=>{
    const file=e.target.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=ev=>{ const lines=ev.target.result.split(/\r?\n/).filter(l=>l.trim()); resetAll(); lines.forEach(addTeamInput); };
    reader.readAsText(file);
  };

  /* --- Tirage map --- */
  let lastMap = null; // m√©morise la derni√®re map tir√©e pour √©viter la r√©p√©tition imm√©diate

  /**
   * showAllMaps()
   * - Affiche toutes les miniatures de maps
   * - Garde la section `selectedMap` cach√©e
   */
  function showAllMaps() {
    mapThumbnails.innerHTML = "";
    selectedMap.classList.add('hidden');
    mapThumbnails.classList.remove('hidden');

    maps.forEach(m => {
      const div = document.createElement('div');
      div.className = "map-item";
      div.innerHTML = `<img src="${m.img}" alt="${m.name}"><strong>${m.name}</strong>`;
      mapThumbnails.appendChild(div);
    });
  }

  /**
   * drawSelectedMap()
   * - S√©lectionne al√©atoirement une map diff√©rente de la pr√©c√©dente si possible
   * - Met √† jour `lastMap` et affiche la map s√©lectionn√©e
   */
  function drawSelectedMap() {
    let shuffled = shuffle([...maps]);
    let selected = shuffled[0];

    // Emp√™che que la m√™me map ressorte deux fois de suite
    if (lastMap && shuffled.length > 1) {
      while (selected.name === lastMap.name) {
        shuffled = shuffle([...maps]);
        selected = shuffled[0];
      }
    }

    lastMap = selected; // on garde la derni√®re map tir√©e

    mapThumbnails.classList.add('hidden');
    selectedMap.classList.remove('hidden');
    selectedMap.innerHTML = `
      <div class="map-item">
        <img src="${selected.img}" alt="${selected.name}">
        <strong>${selected.name}</strong>
      </div>
    `;
  }

  /* --- Navigation (gestion simple des vues) --- */
  teamDrawBtn.onclick=()=>{ selectionView.classList.add('hidden'); setupView.classList.remove('hidden'); mapView.classList.add('hidden'); }
  mapDrawBtn.onclick=()=>{ selectionView.classList.add('hidden'); setupView.classList.add('hidden'); mapView.classList.remove('hidden'); showAllMaps(); }
  backBtn.onclick=goBack;
  mapBackBtn.onclick=()=>{ mapView.classList.add('hidden'); selectionView.classList.remove('hidden'); setupView.classList.add('hidden'); }
  setupBackBtn.onclick = () => {
    setupView.classList.add('hidden');
    selectionView.classList.remove('hidden');
  };

  /* --- Raccourcis boutons setup √©quipe --- */
  addTeamBtn.onclick=()=>addTeamInput();
  resetBtn.onclick=resetAll;
  drawBtn.onclick=drawMatches;
  saveBtn.onclick=saveCSV;
  loadBtn.onclick=loadCSV;

  /* --- Bouton tirage map √©tape 2 --- */
  mapDrawBtnStage2.onclick = drawSelectedMap;

  </script>

</body>
</html>
